<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç™½æ²™ç«èˆç¤¾å¤§æˆï¼é»</title>
  <link rel="icon" href="images/image5.jpg" type="ncuefire_logo" />
  <style>
    @font-face {
      font-family: 'MyHandwrite';
      src: url('fonts/ChenYuluoyan-2.0-Thin.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }   
    html {
      height: auto;
      overflow-y: auto;
    }
    body {
      margin: 0;
      background-color: #111;
      color: #fff;
      font-family: 'MyHandwrite', sans-serif;/*'sans-serif'*/
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* å°é¢ */
    #cover {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      cursor: pointer;
      transition: opacity 1s ease;
    }
    #cover-text1 {
      position: absolute;
      bottom: 20vh;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: white;
      font-family: 'MyHandwrite', sans-serif;/*"Noto Serif TC", serif*/
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
    }
    #cover-text2 {
      position: absolute;
      bottom: 15vh;
      width: 100%;
      text-align: center;
      font-size: 1em;
      color: white;
      font-family: 'MyHandwrite', sans-serif;/*"Noto Serif TC", serif*/
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
      
      animation: breath 2.5s ease-in-out infinite;
    }
    @keyframes breath {
      0% {
        opacity: 0.4;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
      100% {
        opacity: 0.4;
        transform: scale(1);
      }
    }

    #cover img {
      max-width: 90vw;
      max-height: 90vh;
      object-fit: contain;
    }
    #cover.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    #dialogue-image {
      position: fixed;
      bottom: 100px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90vw;
      max-height: 60vh;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 999;
    }
    #dialogue-image.show {
      opacity: 1;
    }
    #dialogue-box {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: none;               /* æ‹¿æ‰èƒŒæ™¯è‰² */
      color: white;                   /* ç™½è‰²æ–‡å­—è¼ƒæ¸…æ™° */
      padding: 30px 20px 50px;        /* å¤šä¸€é»ä¸‹æ–¹ç©ºé–“ */
      box-sizing: border-box;
      text-align: center;
      font-size: 1.5em;               /* ç¨å¾®å¤§ä¸€é» */
      z-index: 1000;
      transition: color 0.3s;
      display: none;
      pointer-events: none;           /* ä¸å¯é»æ“Šï¼Œé¿å…èª¤èªç‚ºæŒ‰éˆ• */
      text-shadow: 1px 1px 5px black; /* å¢åŠ å¯è®€æ€§ï¼ˆé»‘è‰²é™°å½±ï¼‰ */
    }

    #dialogue-box:hover {
      cursor: pointer;
      color: #f90;
    }

    #map {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 80px;
      width: 100%;
      padding-bottom: 100px;
    }
    .scene-button {
      padding: 15px 30px;
      border-radius: 12px;
      background-color: #333;
      color: rgb(165, 150, 150);
      font-size: 1.1em;
      border: 2px solid #666;
      width: 80%;
      max-width: 400px;
      transition: background 0.3s;
    }
    .scene-button:hover {
      background-color: #555;
    }
    .scene-button.active {
      color: #f90; /* é»æ“Šå¾Œé¡¯ç¤ºçš„æ–‡å­—é¡è‰²ï¼Œå¯è‡ªç”±æ›´æ”¹ */
    }
    iframe {
      width: 100vw;
      height: 100vh;
      border: none;
      display: none;
    }

    #back-button {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      display: none;
      cursor: pointer;
      z-index: 1000;
    }

    #progress-container {
      width: 100%;
      background-color: #222;
      height: 10px;
      margin: 0;
      position: fixed;
      top: 0;
      z-index: 1000;
    }
    #progress-bar {
      height: 100%;
      background-color: #f90;
      width: 0%;
      transition: width 0.3s;
    }

    #finale {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      background-color: #000;
      color: #fff;
      text-align: center;
    }
    #finale h2 {
      font-size: 2em;
      margin-bottom: 20px;
    }
    #finale p {
      font-size: 1.1em;
      margin: 10px 0;
    }
    #finale img {
      width: 160px;
      height: auto;
      margin: 10px;
    }

    @media (min-width: 768px) {
      #map {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      .scene-button {
        margin: 10px;
        width: 200px;
      }
    }
    .social-links {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }
    .social-links img {
      width: auto !important;
      height: 60px !important;
      transition: transform 0.2s;
    }
    .social-links a:hover img {
      transform: scale(1.1);
    }
  </style>
</head>
<body>

<!-- å°é¢ -->
<div id="cover" onclick="startIntro()">
  <img src="images/cover.jpg" alt="å°é¢åœ–">
  <div id="cover-text1">ç™½æ²™ç«èˆç¤¾</div>
  <div id="cover-text2">ğŸ‘‰é»æ“Šç•«é¢é–‹å§‹æ—…ç¨‹ğŸ‘ˆ</div>
</div>

<!-- é€²åº¦æ¢ -->
<div id="progress-container"><div id="progress-bar"></div></div>

<!-- å°è©±å°å…¥ -->
<img id="dialogue-image" src="" alt="å°è©±åœ–ç‰‡">
<div id="dialogue-box" onclick="nextDialogue()">é»ä¸€ä¸‹é–‹å§‹ç¯€ç›®å†’éšªï¼</div>

<!-- è¿”å›åœ°åœ– -->
<button id="back-button" onclick="goBack()">â† è¿”å›åœ°åœ–</button>

<!-- åœ°åœ– -->
<div id="map">
  <button class="scene-button" onclick="selectScene(this, 0)">âš« åºç« ï¼šåŸé»</button>
  <button class="scene-button" onclick="selectScene(this, 1)">ğŸ”¥ é»ç«</button>
  <button class="scene-button" onclick="selectScene(this, 2)">â– y=ax+b</button>
  <button class="scene-button" onclick="selectScene(this, 3)">ğŸ” ç„¦é»</button>
  <button class="scene-button" onclick="selectScene(this, 4)">ğŸ™‚ é€—é»</button>
  <button class="scene-button" onclick="selectScene(this, 5)">ã€° åæ›²é»</button>
  <button class="scene-button" onclick="selectScene(this, 6)">ğŸ° é»å¿ƒ</button>
  <button class="scene-button" onclick="selectScene(this, 7)">ğŸ”³ é«”</button>
  <button class="scene-button" onclick="selectScene(this, 8)">ğŸ çµ‚é»</button>
  <button class="scene-button" onclick="selectScene(this, 9)">ğŸ”´ çµ‚ç« ï¼šå¥é»</button>
</div>


<!-- è¼‰å…¥å‹•ç•« -->
<iframe id="scene-frame"></iframe>

<!-- è¬å¹•é é¢ -->
<div id="finale">
  <p id="click-summary" style="margin-top: 20px; line-height: 1.8;"></p>
  <h2>ğŸ‰ è¬å¹• ğŸ‰</h2>
  <p>æ„Ÿè¬æ‚¨çš„è§€è³ï¼</p>
  <p>è¡¨æ¼”åœ˜éšŠï¼šå½°å¸«å¤§ç™½æ²™ç«èˆç¤¾</p>
  <p>æŒ‡å°è€å¸«ï¼šæ­ç»é´»</p>
  <p>ç¡¬é«”è¨­å‚™ï¼šç¥ºå¤©ç‡ˆå…‰éŸ³éŸ¿å·¥ç¨‹</p>
  <p>ç‰¹åˆ¥æ„Ÿè¬æ”å½±ï¼šæ—é›¨ã€å¢¨è·¡ã€æ—äºˆè±ã€æå† ç· </p>
  <p>æ­¡è¿è¿½è¹¤æˆ‘å€‘ï¼š</p>
  <div class="social-links">
    <a href="https://www.facebook.com/ncuefire" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/2023_Facebook_icon.svg/330px-2023_Facebook_icon.svg.png" alt="Facebook logo">
    </a>
    <a href="https://www.instagram.com/ncue_fire/" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/250px-Instagram_logo_2022.svg.png" alt="Instagram logo">
    </a>
    <a href="http://www.youtube.com/@%E5%BD%B0%E5%B8%AB%E5%A4%A7%E7%99%BD%E6%B2%99%E7%81%AB%E8%88%9E%E7%A4%BE" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/YouTube_social_white_circle_%282017%29.svg/250px-YouTube_social_white_circle_%282017%29.svg.png" alt="YouTube logo">
    </a>
  </div>
  
  <!-- å›é¥‹å–®é€£çµ -->
  <p style="margin-top: 30px;">
    ğŸ“‹ <a href="https://forms.gle/MucUrXq9QmNmpWGk8" target="_blank" style="color: #fff; text-decoration: underline;">
      é»æˆ‘å¡«å¯«ç¯€ç›®å›é¥‹å–®
    </a>
  </p>
</div>

<!-- è…³æœ¬ -->
<script>
let isTyping = false;
let typingTimer;

// æ‰“å­—æ©Ÿæ•ˆæœ
function typeWriter(text, element, i = 0) {
  isTyping = true;
  if (i === 0) element.innerText = "";  // é–‹å§‹å‰æ¸…ç©º

  if (i < text.length) {
    element.innerText += text.charAt(i);
    typingTimer = setTimeout(() => typeWriter(text, element, i + 1), 50);
  } else {
    isTyping = false;
  }
}

const dialogues = [
  "æ­¡è¿ä¾†åˆ°ç™½æ²™ç«èˆç¤¾å¤§å‹æˆæœç™¼è¡¨ã€Šé»ã€‹ã€‚",
  "é€™ä¸åªæ˜¯ä¸€å ´è¡¨æ¼”ï¼Œè€Œæ˜¯ä¸€å ´æ—…ç¨‹ã€‚",
  "ä½ å°‡è¸ä¸Šåæ®µç¯€ç›®çš„æ¢ç´¢ä¹‹è·¯ã€‚",
  "æ¯ä¸€å¹•ï¼Œéƒ½è—æœ‰ä¸€æ®µç«ç„°çš„è¨˜æ†¶ã€‚",
  "æº–å‚™å¥½äº†å—ï¼Ÿã€Šé»ã€‹æ“Šé–‹å§‹ã€‚"
];

const dialogueImages = [
  "images/image1.jpg",
  "images/image2.jpg",
  "images/image3.jpg",
  "images/image4.jpg",
  "images/image5.jpg"
];

let index = 0;
let visitedScenes = new Set();
let lastScene = -1;

function startIntro() {
  document.getElementById("cover").classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("cover").style.display = "none";
    document.getElementById("dialogue-box").style.display = "block";
    nextDialogue();
  }, 1000);
}

function nextDialogue() {
  const box = document.getElementById("dialogue-box");
  const image = document.getElementById("dialogue-image");

  // å¦‚æœé‚„åœ¨æ‰“å­—ï¼Œç›´æ¥è·³éæ‰“å®Œ
  if (isTyping) {
    clearTimeout(typingTimer);
    box.innerText = dialogues[index - 1];  // é¡¯ç¤ºå®Œæ•´ä¸Šä¸€å¥
    isTyping = false;
    return;
  }

  if (index < dialogues.length) {
    image.classList.remove("show");
    image.src = dialogueImages[index];
    setTimeout(() => image.classList.add("show"), 10);

    // æ‰“å­—æ©Ÿé–‹å§‹
    typeWriter(dialogues[index], box);
    index++;
  } else {
    box.style.display = 'none';
    image.style.display = 'none';
    document.getElementById("map").style.display = 'flex';
  }
}


document.getElementById("dialogue-box").addEventListener("mouseenter", () => {
  if (index === 0) {
    document.getElementById("dialogue-box").innerText = "ğŸ”¥ é»ä¸€ä¸‹é–‹å§‹ç¯€ç›®å†’éšªï¼";
  }
});
document.getElementById("dialogue-box").addEventListener("mouseleave", () => {
  if (index === 0) {
    document.getElementById("dialogue-box").innerText = "é»ä¸€ä¸‹é–‹å§‹ç¯€ç›®å†’éšªï¼";
  }
});

const sceneLinks = [
  "scenes/scene1/index.html",
  "scenes/scene2/index.html",
  "scenes/scene3/index.html",
  "scenes/scene4/index.html",
  "scenes/scene5/index.html",
  "scenes/scene6/index.html",
  "scenes/scene7/index.html",
  "scenes/scene8/index.html",
  "scenes/scene9/index.html",
  "scenes/scene10/index.html"
];

function loadScene(i) {
  document.getElementById("map").style.display = 'none';
  document.getElementById("finale").style.display = 'none';
  const frame = document.getElementById("scene-frame");
  frame.src = sceneLinks[i];
  frame.style.display = 'block';
  document.getElementById("back-button").style.display = 'block';

  visitedScenes.add(i);
  lastScene = i;
  updateProgressBar();
}

function goBack() {
  document.getElementById("scene-frame").style.display = 'none';
  document.getElementById("scene-frame").src = '';
  document.getElementById("back-button").style.display = 'none';

  // è‹¥å›ä¾†çš„æ˜¯ç¬¬9å¹•ï¼ˆæœ€å¾Œä¸€å¹•ï¼‰ï¼Œä¸”æ‰€æœ‰å ´æ™¯éƒ½å®Œæˆï¼Œé¡¯ç¤ºè¬å¹•
  if (/*lastScene === 9 &&*/ visitedScenes.size === sceneLinks.length) {
    showFinale();
  } else {
    document.getElementById("map").style.display = 'flex';
  }
}

function showFinale() {
  document.getElementById("finale").style.display = 'flex';
  const summary = document.getElementById("click-summary");
  summary.innerHTML = `é€™è¶Ÿæ—…é€”ä¸­ï¼Œæ‚¨å…±ã€Šé»ã€‹æ“Šäº† 
    <span style="color: #f90; font-weight: bold;">${totalClicks}</span> æ¬¡ã€‚<br>
    æ¯ä¸€æ¬¡è§¸ç¢°ï¼Œéƒ½æ˜¯ç«èŠ±çš„ç¶»æ”¾ï¼›<br>æ¯ä¸€æ®µæ¢ç´¢ï¼Œéƒ½æ˜¯æ•…äº‹çš„å»¶çºŒã€‚<br>
    è¬è¬æ‚¨é™ªæˆ‘å€‘å®Œæˆé€™è¶Ÿæ—…ç¨‹ï¼`;
}

function updateProgressBar() {
  const progress = (visitedScenes.size / sceneLinks.length) * 100;
  document.getElementById("progress-bar").style.width = progress + "%";
}

let totalClicks = 0;

// çˆ¶é é¢è‡ªèº«é»æ“Šç›£è½
document.addEventListener("click", () => {
  totalClicks++;
  console.log("çˆ¶é é¢é»æ“Šï¼Œç¸½é»æ“Šæ•¸: ", totalClicks);
  updateClickDisplay();
});

// ç›£è½ä¾†è‡ªå­é é¢çš„è¨Šæ¯
window.addEventListener("message", (event) => {
  const data = event.data;
  if (data && data.type === "childClick") {
    totalClicks++;
    console.log("å­é é¢é»æ“Šï¼Œç¸½é»æ“Šæ•¸: ", totalClicks);
    updateClickDisplay();
  }
});

// é¡¯ç¤ºé»æ“Šæ•¸çš„å‡½å¼
function updateClickDisplay() {
  const display = document.getElementById("clickCountDisplay");
  if(display) {
    display.textContent = `ç¸½é»æ“Šæ•¸ï¼š${totalClicks}`;
  }
}

document.addEventListener("click", () => {
  if (document.getElementById("dialogue-box").style.display === "block") {
    nextDialogue();
  }
});

function selectScene(button, sceneIndex) {
    // åŠ ä¸Šç›®å‰é»æ“Šçš„æŒ‰éˆ• active class
    button.classList.add('active');
    // è¼‰å…¥è©²å ´æ™¯
    loadScene(sceneIndex);
}

</script>
</body>
  <!-- <div id="clickCountDisplay" style="font-size:20px; font-weight:bold;">ç¸½é»æ“Šæ•¸ï¼š0</div> -->

</html>
